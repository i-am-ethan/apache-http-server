# Apache入門

## 目次

1. **Apacheとはサイゼリヤでミラノ風ドリアを注文することと同義である**
2. **Apacheとは？**
3. **Webサーバーの歴史**
4. **世界で最初のWebサーバー**
5. **Apacheの前身のWebサーバー**
6. **Apacheの歴史**
7. **Apacheは誰が作ったか**
8. **Apacheはなぜ作られたか**
9. **Apacheを学ぶ理由**
10. **Apacheでできること**
11. **Apacheへの批判**
12. **ApacheからNginxへ**

---

## 第1章：Apacheとはサイゼリヤでミラノ風ドリアを注文することと同義である

突然ですが、
あなたはサイゼリヤで『ミラノ風ドリア』を注文したことがありますでしょうか。

ある方も、ない方も想像してみてください。

あなたがサイゼリヤでミラノ風ドリアを注文するプロセスは以下のようになると思います。

(1)あなたはサイゼリヤというファミリーレストランに入店します。

(2)席につき、メニューを開きます。

(3)注文する料理を決定したら、ウェイターを呼びます。

(4)ウェイターが到着すると
あなたは『ミラノ風ドリアを1つ下さい』と
ウェイターに伝えます。

(5)すると、ウェイターは
あなたがミラノ風ドリアを注文したことを
キッチンに伝えます。
そして、キッチンはミラノ風ドリアを料理します。

(6)数分後、あなたの元にウェイターがやってきて
ミラノ風ドリアを提供してくれるのです。

アパッチは、まさにこのウェイターの動きとそっくりの機能を提供します。
アパッチは、顧客から注文を聞いてミラノ風ドリアを作ってくださいとキッチンに伝え、ミラノ風ドリアが完成したら客に提供をする。ウェイターとそっくりなのです。

それではサイゼリヤをインターネットに置き換えて考えてみましょう。

(1)あなたはパソコンを開き、Google ChromeやSafariとったWebブラウザを開きます。

(2)ブラウザで興味のあることを検索します。例えば『ポリモーフィズム 簡単 解説』などと検索します。

(3)検索結果の一覧を確認し、その中から良さそうなページを探します。

(4)『猿でもわかるポリモーフィズム』という良さそうなページのリンクをクリックします。

(5)クリックが行われると、アパッチはサーバーに対して必要な情報を伝えます。そして、サーバーはウェブページを作成します。場合によっては作成済みのウェブページがあるのでその場合はわざわざサーバーに伝えません。

(6)ウェブページが完成(or作成済みのWebページがある)すると、
アパッチはそれをあなたに表示します。
そして、あなたはウェブページを閲覧できるようになります。

アパッチとサイゼリヤのウェイターが近い存在であるということがお分かりいただけたでしょうか？
わかりづらかった方はそっとこのページを閉じてください。
そうでない方はこの先の文章を読むことで、
よりアパッチについて知れると思います。

---

## 第2章：Apacheとは？


### オープンソースのウェブサーバーソフトウェア

Apache（アパッチ）の正式名称は「Apache HTTP Server」といいます。
Apache Software Foundation（ASF）によって開発・提供されているオープンソースのウェブサーバーソフトウェアです。

世界中のウェブサイトの約31％（Netcraft調べ、2021年時点）がApacheを利用しており、その普及率はトップクラスです。
最近はNginxというwebサーバーもよく使われています。

### 多彩な機能と拡張性

Apacheは多機能で拡張性が高いことが特徴です。
モジュール方式を採用しており、必要な機能を追加・削除することが容易です。
代表的なモジュールには、以下のものがあります。

- **mod_ssl**：SSL/TLSを利用したセキュアな通信を実現
- **mod_rewrite**：URLの書き換えやリダイレクトを柔軟に設定
- **mod_proxy**：プロキシサーバーやリバースプロキシとして機能

### クロスプラットフォーム対応

Apacheはクロスプラットフォーム対応であり、
Linux、Unix、Windows、macOSなど、
さまざまなオペレーティングシステム上で動作します。

このため、環境に依存せずにウェブサーバーを構築・運用することが可能です。

### HTTPプロトコルのサポート

名前の通り、
Apache HTTP ServerはHTTP（HyperText Transfer Protocol）をサポートしています。
HTTP/1.1はもちろん、近年ではHTTP/2やHTTP/3（実験的）にも対応しており、高速かつ効率的な通信を実現しています。

### オープンソースコミュニティの支援

Apacheはオープンソースであり、
世界中の開発者コミュニティによって支えられています。
https://github.com/apache/httpd

これにより、継続的な機能拡張やセキュリティアップデートが迅速に行われています。


---

## 第3章：Webサーバーの歴史

アパッチはWebサーバーの1つであるとお伝えしました。
Webサーバーの歴史について学んでみましょう。

### インターネットの誕生と初期のウェブ

インターネットは1960年代後半にアメリカ国防総省のARPANETプロジェクトとして始まりました。
その後、1989年にティム・バーナーズ＝リーがWorld Wide Web（WWW）の概念を提唱し、1990年に初のウェブサーバーとウェブブラウザが誕生しました。

### 初期のウェブサーバー

初期のウェブサーバーは、ティム・バーナーズ＝リーがCERN（欧州原子核研究機構）で開発した「CERN httpd」でした。
このサーバーは、NeXTコンピュータ上で動作し、基本的なHTTPリクエストに応答するシンプルなものでした。

CERN httpdについて興味がある方はこちらのドキュメントを閲覧ください。
https://www.w3.org/Daemon/User/

### ウェブの急速な普及

1990年代に入り、ウェブは急速に普及しました。
これに伴い、より高性能で機能的なウェブサーバーの需要が高まりました。

1993年には、NCSA（National Center for Supercomputing Applications）が「NCSA HTTPd」をリリースし、多くのウェブサイトで採用されました。


### 商用ウェブサーバーの登場

同時期に、商用のウェブサーバーも登場しました。例えば、Netscape Communications社が開発した「Netscape Enterprise Server」は、
高度な機能とサポートを提供し、企業向けのソリューションとして普及しました。

### オープンソースウェブサーバーの重要性

商用ウェブサーバーが台頭する中、オープンソースのウェブサーバーも重要性を増していきました。
自由に利用・改良できるオープンソースソフトウェアは、技術者コミュニティによって支えられ、ウェブの発展に大きく寄与しました。


---

## 第4章：世界で最初のWebサーバー

### CERN httpdの誕生

世界で最初のウェブサーバーは、ティム・バーナーズ＝リーによって開発された「CERN httpd」です。

https://ja.wikipedia.org/wiki/%E3%83%86%E3%82%A3%E3%83%A0%E3%83%BB%E3%83%90%E3%83%BC%E3%83%8A%E3%83%BC%E3%82%BA%EF%BC%9D%E3%83%AA%E3%83%BC

1990年12月25日、彼は自身のNeXTコンピュータを使って初のウェブサーバーを稼働させました。
このサーバーは、WWWプロジェクトの一環として開発され、
HTTPプロトコルの実装とウェブコンテンツの提供を行いました。

<img src="./images/First_Web_Server.jpg" />

### NeXTコンピュータとウェブ

NeXTコンピュータは、スティーブ・ジョブズがAppleを退社した後に設立したNeXT社が開発した高性能ワークステーションです。ティム・バーナーズ＝リーは、このコンピュータの高度な開発環境を活用して、ウェブサーバーとウェブブラウザを開発しました。

### 世界初のウェブサイト

CERN httpdが稼働する中で、世界初のウェブサイトである「http://info.cern.ch/」
が公開されました。
現在は閲覧できません。

このサイトには、WWWプロジェクトの概要や、ウェブの仕組み、ブラウザやサーバーの入手方法などが掲載されていました。

### 公開と普及

1991年8月6日、ティム・バーナーズ＝リーは、CERNのメーリングリストにウェブの概要を投稿し、ウェブ技術を広く公開しました。これがきっかけとなり、世界中の研究者や技術者がウェブの開発に参加し始めました。

### パブリックドメイン化

1993年4月30日、CERNはウェブの技術をパブリックドメインとして公開しました。これにより、誰もが自由にウェブ技術を利用・改良できるようになり、ウェブの爆発的な普及を促進しました。

---

## 第5章：Apacheの前身のWebサーバー


### NCSA HTTPdの重要性

Apacheの前身として最も影響力があったのが「NCSA HTTPd」です。1993年にNCSA（アメリカ国立スーパーコンピュータ応用研究所）のRob McCoolによって開発されました。このウェブサーバーは、CERN httpdよりも高機能で、設定も容易であったため、急速に普及しました。

### 新機能の導入

NCSA HTTPdは、CGI（Common Gateway Interface）のサポートやアクセス制御、ログ機能など、当時としては先進的な機能を提供しました。特にCGIは、動的なウェブコンテンツの生成を可能にし、ウェブの可能性を大きく広げました。

### 開発の停滞とコミュニティの対応

しかし、1994年にRob McCoolがNetscape Communicationsに移籍したことで、NCSA HTTPdの開発は停滞しました。公式のアップデートが途絶えたため、ユーザーコミュニティは自分たちでバグ修正や機能追加のパッチを作成し、共有し始めました。

### パッチの統合と「a patchy server」

多くのパッチが散在する中で、これらを統合して一つの安定したバージョンを作る動きが出てきました。この統合版が「a patchy server」、つまり「パッチだらけのサーバー」と呼ばれ、それが「Apache」の名前の由来の一つとされています。

---

## 第6章：Apacheの歴史

### Apache Groupの結成

1995年初頭、NCSA HTTPdの開発停滞を受けて、Brian BehlendorfやRoy Fieldingをはじめとする8人の開発者が集まりました。彼らはNCSA HTTPdのパッチを統合し、安定したウェブサーバーを提供するために「Apache Group」を結成しました。

### 初期のリリース

1995年4月、Apache HTTP Serverの最初のバージョンである「Apache 0.6.2」がリリースされました。その後も積極的な開発と改良が行われ、同年末にはバージョン0.8.8がリリースされました。

### バージョン1.0の登場

1995年12月1日、正式な安定版である「Apache 1.0.0」がリリースされました。このバージョンは、性能と安定性に優れ、多くのウェブサイトで採用されました。

### Apache Software Foundationの設立

1999年、Apacheの開発と運営をより組織的に行うために、非営利団体「Apache Software Foundation（ASF）」が設立されました。ASFは、Apache HTTP Serverをはじめとする多くのオープンソースプロジェクトを支援・管理しています。

### バージョン2.0とその進化

2002年4月、Apache HTTP Server 2.0がリリースされました。このバージョンでは、マルチプロセッシングモジュール（MPM）の導入や、プラットフォーム間の互換性向上など、大幅な機能強化が行われました。その後も2.2、2.4とバージョンアップが続き、現在も活発な開発が続けられています。

---

## 第7章：Apacheは誰が作ったか

### 初期の開発者たち

Apacheは特定の一人によって作られたものではなく、多くの開発者の協力によって生まれました。初期の主要メンバーには以下の人物が含まれます。

- **Brian Behlendorf**：Apache Groupのリーダーとしてプロジェクトを牽引
- **Roy Fielding**：HTTPプロトコルの開発やRESTアーキテクチャの提唱者
- **Rob Hartill**：コードの開発とレビューに貢献
- **Cliff Skolnick**：インフラストラクチャの整備や組織運営を担当
- **Randy Terbush**：ビルドシステムの改良やドキュメンテーションを担当


### オープンソースコミュニティの力

これらのメンバー以外にも、世界中の多くの開発者がApacheの開発に参加しました。オープンソースの開発モデルにより、誰でもコードの改良やバグ修正に貢献できる体制が整えられていました。

### Roy FieldingとHTTPプロトコル

特にRoy Fieldingは、HTTP/1.1の主要な設計者であり、ウェブの基盤となるプロトコルの開発に深く関わりました。また、彼の博士論文で提唱されたREST（Representational State Transfer）は、ウェブアプリケーションの設計に大きな影響を与えました。

Roy Fielding:
https://roy.gbiv.com/

---

## 第8章：Apacheはなぜ作られたか

### 開発停滞への対応

Apacheが作られた主な理由は、NCSA HTTPdの開発が停滞したことにあります。ウェブの急速な発展に伴い、ウェブサーバーには新機能の追加やバグ修正が求められていました。しかし、公式のアップデートが行われなかったため、ユーザーコミュニティが自発的にパッチを作成し、それを統合する必要が生じました。

### オープンソースの理念

当時、オープンソースソフトウェアの重要性が高まり始めていました。ソフトウェアの自由な利用・改良・再配布を可能にすることで、技術の進歩とイノベーションを促進するという理念です。Apacheはこの理念に基づき、オープンソースとして開発・公開されました。

### 信頼性と拡張性の追求

Apacheの開発者たちは、信頼性が高く、拡張性に優れたウェブサーバーを目指しました。モジュール方式の採用により、必要な機能を柔軟に追加できるように設計されました。また、高いパフォーマンスと安定性を実現するために、コードの最適化やプロトコルの改良が行われました。

---

## 第9章：Apacheを学ぶ理由

### ウェブサーバーの基礎理解

Apacheを学ぶことで、ウェブサーバーの基本的な仕組みや動作原理を理解できます。HTTPプロトコルやリクエスト・レスポンスの流れ、サーバーの設定方法など、ウェブ開発に欠かせない知識が身につきます。

### サーバー管理と運用スキルの習得

Apacheの設定やチューニングを学ぶことで、サーバー管理者としてのスキルを向上させることができます。セキュリティ設定、アクセス制御、ログ解析など、実務で必要となる技術を習得できます。

### オープンソースコミュニティへの参加

Apacheはオープンソースソフトウェアであるため、コードを読んだり、自分でモジュールを開発したりすることが可能です。コミュニティに参加して他の開発者と交流することで、知識の共有や技術力の向上が期待できます。

### キャリアの幅を広げる

Apacheは多くの企業や組織で採用されており、その知識や経験は就職やキャリアアップに有利です。特にウェブ開発やサーバー管理の分野で活躍したい人にとって、Apacheのスキルは重要な武器となります。

---

## 第10章：Apacheでできること

### 静的コンテンツの配信

Apacheは、HTML、CSS、JavaScript、画像などの静的コンテンツを効率的に配信します。高速なレスポンスとキャッシュ機能により、ユーザーに快適なウェブ体験を提供します。

### 動的コンテンツの処理

CGI、PHP、Perl、Python、Rubyなどのスクリプト言語を用いた動的コンテンツの生成をサポートしています。mod_phpやmod_perlなどのモジュールを利用することで、アプリケーションのパフォーマンスを向上させることができます。

### セキュアな通信の実現

mod_sslモジュールを利用して、SSL/TLSによる暗号化通信を実現できます。Let's Encryptなどの無料のSSL証明書を導入することで、HTTPS対応のウェブサイトを簡単に構築できます。

### リバースプロキシ機能

mod_proxyモジュールを使って、リバースプロキシサーバーとして機能させることができます。これにより、バックエンドのアプリケーションサーバー（Tomcat、Node.jsなど）との連携が容易になります。

### URLリライトとアクセス制御

mod_rewriteモジュールを利用して、URLの書き換えやリダイレクトを柔軟に設定できます。また、.htaccessファイルを用いたディレクトリ単位のアクセス制御や認証設定が可能です。

### 仮想ホストの設定

一台のサーバーで複数のドメインやウェブサイトを運用するための仮想ホスト機能を提供しています。名前ベース、IPベース、ポートベースの仮想ホスト設定が可能です。

### まとめ

Apacheは多機能なウェブサーバーとして、ウェブサイトやウェブアプリケーションの構築・運用において強力なツールとなります。その豊富な機能を活用することで、様々な要件に対応したシステムを実現できます。

---

## 第11章：Apacheへの批判

### パフォーマンスの課題

Apacheはマルチプロセス・マルチスレッドモデルを採用しており、接続ごとにプロセスやスレッドを生成します。大量の同時接続がある場合、プロセスやスレッドのオーバーヘッドが増大し、パフォーマンスが低下することがあります。

### メモリ消費量

多くのモジュールを有効にすると、プロセスごとのメモリ使用量が増加します。特に、リソースが限られた環境では、メモリ不足によるパフォーマンス低下やシステムの不安定化が懸念されます。

### 設定の複雑さ

高度な機能を利用する場合、設定ファイル（httpd.confなど）が複雑になりがちです。細かな設定項目が多く、誤った設定をするとセキュリティリスクや動作不良の原因となります。

### 新しい技術への対応

近年のウェブ技術（HTTP/2、HTTP/3、WebSocketなど）への対応が他のウェブサーバーに比べて遅れることがあります。また、モダンな開発フレームワークとの親和性が低いと指摘されることもあります。


---

## 第12章：ApacheからNginxへ

### Nginxの登場

Nginx（エンジンエックス）は、2004年にロシアのエンジニアIgor Sysoevによって開発されたウェブサーバー・リバースプロキシサーバーです。Nginxは、Apacheの抱えるパフォーマンス問題を解決するために設計されました。

### イベント駆動型アーキテクチャ

Nginxは、イベント駆動型・非同期処理モデルを採用しており、シングルスレッドで大量の同時接続を効率的に処理できます。これにより、低いメモリ使用量で高いパフォーマンスを実現しています。

### 設定のシンプルさ

Nginxの設定ファイルは、シンプルで直感的な構造になっています。モジュールも組み込み式であり、必要な機能だけを有効にすることで、無駄なリソース消費を抑えられます。

### Nginxの普及

高トラフィックなウェブサイト（Netflix、Airbnb、Instagramなど）がNginxを採用しており、その信頼性と性能が実証されています。Netcraftの調査によれば、Nginxは現在、世界で最も普及しているウェブサーバーとなっています。

### Apacheからの移行

パフォーマンスやリソース効率の向上を目的に、ApacheからNginxへ移行するケースが増えています。また、Nginxをリバースプロキシとしてフロントエンドに配置し、バックエンドでApacheを動作させるハイブリッド構成も一般的です。

---

**総まとめ**

この記事では、Apacheの基本から歴史、技術的な詳細、そして現在のウェブサーバー事情までを解説しました。Apacheは長年にわたりウェブの基盤を支えてきましたが、新しい技術やニーズの変化に伴い、他のウェブサーバーとの使い分けが求められています。

技術は常に進歩しています。Apacheを学ぶことは、ウェブの仕組みを深く理解する第一歩です。これからも新しい知識を積極的に取り入れ、技術者としてのスキルを磨いていきましょう。